---
import Layout from "../../../../layouts/BaseLayout.astro";
import NavCard from "../../../../components/NavCard.astro";
import PageNav from "../../../../components/PageNav.astro";

export async function getStaticPaths({ paginate }) {
  const allBlogs = await Astro.glob("../../*.mdx");
  const nonDraftBlogs = allBlogs.filter((blog) => !blog.frontmatter.draft);
  const uniqueSeries = [
    ...new Set(nonDraftBlogs.map((blog) => blog.frontmatter.series).flat()),
  ];
  return uniqueSeries.map((series) => {
    const filteredBlogs = nonDraftBlogs.filter((blog) =>
      blog.frontmatter.series?.includes(series)
    );
    return paginate(filteredBlogs, {
      params: { series },
      pageSize: 10,
    });
  });
}
const { series } = Astro.params;
const { page } = Astro.props;
const title = series;
const description = `The home of my ${series} series.`;
const capitalise = (str) => {
  return str.charAt(0).toUpperCase() + str.slice(1);
};
const seriesPages = await Astro.glob("../../../../components/series/*.mdx");
const seriesPage = seriesPages.filter((page) =>
  page.frontmatter.series?.includes(series)
);
const SeriesPageContent = seriesPage[0].Content;
---

<Layout title={capitalise(title)} description={description}>
  <SeriesPageContent />
  <ul>
    {page.data.map((blog) => <NavCard post={blog} />)}
  </ul>
  <PageNav page={page} />
</Layout>
<style>
  ul {
    padding: 0;
    margin: 0;
  }
  a {
    text-decoration: none;
    color: black;
    display: block;
    padding: 1rem;
  }
  li {
    list-style: none;
    border: 1px solid black;
    border-radius: 4px;
    margin: 1rem 0;
  }
  img {
    height: 80px;
    width: auto;
    float: right;
    margin-left: 1rem;
  }
  h3 {
    margin-top: 0px;
  }
</style>
