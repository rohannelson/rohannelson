---
import Layout from "./Layout.astro";
import NavCard from "../components/NavCard.astro";
import Metadata from "../components/Metadata.astro";
const { frontmatter } = Astro.props;
const allBlogs = await Astro.glob("../pages/blog/*.mdx");
let previousBlogObj: any = {};
let nextBlogObj: any = {};
allBlogs.forEach((blog, i) => {
    if (frontmatter.title === blog.frontmatter.title) {
        previousBlogObj = allBlogs[i - 1];
        nextBlogObj = allBlogs[i + 1];
    }
});
let filteredBlogs = [];
const uniqueTags = [...new Set(frontmatter.tags.map((tag) => tag).flat())];
uniqueTags.forEach((tag) => {
    filteredBlogs = allBlogs.filter((blog) => {
        return blog.frontmatter.tags.includes(tag);
    });
});
let nextInSeries: any = {};
let previousInSeries: any = {};
filteredBlogs.forEach((blog, i) => {
    if (frontmatter.title === blog.frontmatter.title) {
        previousInSeries = filteredBlogs[i - 1];
        nextInSeries = filteredBlogs[i + 1];
    }
});
console.log(previousInSeries);
---

<Layout title={frontmatter.title} description={frontmatter.description}>
    <Metadata frontmatter={frontmatter} />
    <img src={frontmatter.image ?? "/img/blog.svg"} />
    <slot />
    <hr />
    <ul>
        {
            nextInSeries && (
                <NavCard
                    cardURL={nextInSeries.url}
                    cardHeading={
                        "Next in Series: " + nextInSeries.frontmatter.title
                    }
                    cardDescription={nextInSeries.frontmatter.description}
                    cardImage={nextInSeries.frontmatter.image}
                />
            )
        }
        {
            nextBlogObj && nextBlogObj != nextInSeries && (
                <NavCard
                    cardURL={nextBlogObj.url}
                    cardHeading={"Next Blog: " + nextBlogObj.frontmatter.title}
                    cardDescription={nextBlogObj.frontmatter.description}
                    cardImage={nextBlogObj.frontmatter.image}
                />
            )
        }
        {
            previousInSeries && (
                <NavCard
                    cardURL={previousInSeries.url}
                    cardHeading={
                        "Previous in Series: " +
                        previousInSeries.frontmatter.title
                    }
                    cardDescription={previousInSeries.frontmatter.description}
                    cardImage={previousInSeries.frontmatter.image}
                />
            )
        }
        {
            previousBlogObj && previousBlogObj != previousInSeries && (
                <NavCard
                    cardURL={previousBlogObj.url}
                    cardHeading={
                        "Previous Blog: " + previousBlogObj.frontmatter.title
                    }
                    cardDescription={previousBlogObj.frontmatter.description}
                    cardImage={previousBlogObj.frontmatter.image}
                />
            )
        }
    </ul>
    <style>
        img {
            width: 200px;
            max-width: 30vw;
            height: auto;
            float: right;
            padding: 10px 10px 5px 10px;
        }
        ul {
            display: flex;
            padding: 0;
            flex-direction: column;
        }
    </style>
</Layout>
