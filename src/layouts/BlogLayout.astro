---
import Layout from "./Layout.astro";
import NavCard from "../components/NavCard.astro";
import Metadata from "../components/Metadata.astro";
const { frontmatter } = Astro.props;
const allBlogs = await Astro.glob("../pages/blog/*.mdx");
let previousBlogObj: any = {};
let nextBlogObj: any = {};
allBlogs.forEach((blog, i) => {
    if (frontmatter.title === blog.frontmatter.title) {
        previousBlogObj = allBlogs[i - 1];
        nextBlogObj = allBlogs[i + 1];
    }
});
let filteredBlogs = [];
const uniqueTags = [...new Set(frontmatter.tags.map((tag) => tag).flat())];
uniqueTags.forEach((tag) => {
    filteredBlogs = allBlogs.filter((blog) => {
        return blog.frontmatter.tags.includes(tag);
    });
});
let nextInSeries: any = {};
let previousInSeries: any = {};
filteredBlogs.forEach((blog, i) => {
    if (frontmatter.title === blog.frontmatter.title) {
        previousInSeries = filteredBlogs[i - 1];
        nextInSeries = filteredBlogs[i + 1];
    }
});
---

<Layout title={frontmatter.title} description={frontmatter.description}>
    <Metadata frontmatter={frontmatter} />
    <img src={frontmatter.image ?? "/img/blog.svg"} />
    <slot />
    <hr />
    <ul>
        {
            nextInSeries && (
                <NavCard post={nextInSeries} titlePrefix="Next in Series: " />
            )
        }
        {
            nextBlogObj && nextBlogObj != nextInSeries && (
                <NavCard post={nextBlogObj} titlePrefix="Next Blog: " />
            )
        }
        {
            previousInSeries && (
                <>
                    <NavCard
                        post={previousInSeries}
                        titlePrefix="Previous in Series: "
                    />
                </>
            )
        }
        {
            previousBlogObj && previousBlogObj != previousInSeries && (
                <NavCard post={previousBlogObj} titlePrefix="Previous Blog: " />
            )
        }
    </ul>
    <style>
        img {
            width: 200px;
            max-width: 30vw;
            height: auto;
            float: right;
            padding: 10px 10px 5px 10px;
        }
        ul {
            display: flex;
            padding: 0;
            flex-direction: column;
        }
    </style>
</Layout>
